---
title: "Codebook and Descriptive Analysis of"
subtitle: "Confirmed Cases and Deaths by County"
author: "NYU A3SR"
output: 
  html_document:
    df_print: paged
    theme: paper
    highlight: kate
    toc: true
    toc_float: 
      collapsed: false
      smooth_scroll: false
    toc_depth: 3
    number_sections: false
    code_folding: hide
---

```{r setup, message=FALSE, warning=FALSE}
if(!requireNamespace("dplyr"))
  install.packages("dplyr", repos = "https://cloud.r-project.org")
if(!requireNamespace("data.table"))
  install.packages("data.table", repos = "https://cloud.r-project.org")
if(!requireNamespace("here"))
  install.packages("here", repos = "https://cloud.r-project.org")
if(!requireNamespace("ggplot2"))
  install.packages("ggplot2", repos = "https://cloud.r-project.org")
require(data.table)
require(dplyr)
library(here)
require(ggplot2)
```

## Introduction

The `usa-facts` folder contains data of confirmed cases and deaths of all counties in the United States, provided by [USA FACTS](https://usafacts.org/visualizations/coronavirus-covid-19-spread-map/). The data are updated on a daily basis and are stored in folders with date&time stamps. 

Please use this codebook document as a reference to various procedures, such as data processing and variable naming. 

## Creating the tidy datafile

1. Daily nation-wide total confirmed cases

2. Most recent confirmed cases by county (as of 03-27-2020)

```{r data-processing-hide, include=FALSE}
# Data Name: covid_confirmed_usafacts_03272020.csv
# Path: data/raw/usa-facts/03-27-2020/

# Load -------------------------------------------------------------------------
here::here()
dat <- fread("data/raw/usa-facts/03-27-2020/covid_confirmed_usafacts_03272020.csv")
```

## Descriptive Analysis

### Data Structure {.tabset}

Data are ordered in time series. Starting from Jan. 22, 2020 (1/22/2020), county-level confirmed cases were recorded daily. Each value time stamp variables is cumulative. For example, the value of confirmed cases in Queens, NY on Mar. 27, 2020 is calculated by adding cumulative confirmed cases on Mar. 26, 2020 with new cases confirmed on Mar. 27. Therefore, to get daily new cases, we can simply subtract the value on a particular day with the value in the previous day. 

#### Overview

Top 5 rows of raw data

```{r data-show-1-1, warning=FALSE, message=FALSE, include=TRUE}
head(dat, 5)
```

Bottom 5 rows of raw data

```{r data-show-1-2, warning=FALSE, message=FALSE, include=TRUE}
tail(dat, 5)
```

```{r data-show-1-hide, warning=FALSE, message=FALSE, include=FALSE}
table(is.na(dat)) # Check if there are missing values
summary(dat[, 70]) # Review the distribution of confirmed cases as of 03-27-2020

# Queens County, NY has the highest confirmed cases as of 03-27-2020
dat$`County Name`[dat$`3/27/2020` == max(dat$`3/27/2020`)]
dat$State[dat$`3/27/2020` == max(dat$`3/27/2020`)]

# 1450 counties have zero confirmed case as of 03-27-2020
table(dat$`3/27/2020` == 0)
```

#### Daily Nation-wide Total

A summary table of nation-wide daily total confirmed cases is attached. 

```{r data-show-2, warning=FALSE, message=FALSE}
# Create a table showing daily total confirmed cases, nation-wide
date <- as.Date(paste("0", colnames(dat[, 5:70]) , sep = ""), "%m/%d/%y")

total_confirmed_daily <- lapply(dat[, 5:70], FUN = sum)
total_confirmed_daily <- t(as.matrix(as.data.frame(total_confirmed_daily)))
total_confirmed_daily <- data.frame(date = date, 
                                    total_confirmed = total_confirmed_daily)
row.names(total_confirmed_daily) <- NULL

total_confirmed_daily
```

#### Most Recent by County

```{r data-show-3, warning=FALSE, message=FALSE}
# Create a tidy datafile to include only 
# county, state, and most recent confirmed cases.
total_cases <- total_confirmed_daily[nrow(total_confirmed_daily), 2]
dat_most_recent <- dat %>%
  select(
    "county" = "County Name",
    "state" = "State",
    "most_recent" = "3/27/2020"
  ) %>%
  group_by(state) %>%
  arrange(desc(most_recent)) %>%
  mutate(
    percentage_of_total = round(most_recent / total_cases, digits = 3)
  )

dat_most_recent
```

#### Raw Data

```{r data-show-4, warning=FALSE, message=FALSE}
# Get an overview on the data
glimpse_dat <- glimpse(dat) 
glimpse_dat
```

### Basic Visualization {.tabset}

#### Daily Nation-wide Total

```{r viz-1, warning=FALSE}
ggplot(total_confirmed_daily, aes(x = date, y = total_confirmed)) + 
  geom_point()
```










